<!DOCTYPE html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

    <title>Babylon.js sample code</title>

    <!-- Babylon.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.6.2/dat.gui.min.js"></script>
    <script src="https://assets.babylonjs.com/generated/Assets.js"></script>
    <script src="https://preview.babylonjs.com/ammo.js"></script>
    <script src="https://preview.babylonjs.com/cannon.js"></script>
    <script src="https://preview.babylonjs.com/Oimo.js"></script>
    <script src="https://preview.babylonjs.com/earcut.min.js"></script>
    <script src="https://preview.babylonjs.com/babylon.js"></script>
    <script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.min.js"></script>
    <script src="https://preview.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
    <script src="https://preview.babylonjs.com/postProcessesLibrary/babylonjs.postProcess.min.js"></script>
    <script src="https://preview.babylonjs.com/loaders/babylonjs.loaders.js"></script>
    <script src="https://preview.babylonjs.com/serializers/babylonjs.serializers.min.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.min.js"></script>
    <script src="https://preview.babylonjs.com/inspector/babylon.inspector.bundle.js"></script>

    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            outline: none;
        }

        #renderCanvas {
            width: 100%;
            height: 100%;
            touch-action: none;
        }
    </style>
</head>

<body>
    <canvas id="renderCanvas"></canvas>
    <script>
        var canvas = document.getElementById("renderCanvas");

        !function (A, e) { "object" == typeof exports && "object" == typeof module ? module.exports = e() : "function" == typeof define && define.amd ? define([], e) : "object" == typeof exports ? exports.NoSleep = e() : A.NoSleep = e() }("undefined" != typeof self ? self : this, function () { return function (A) { function e(B) { if (o[B]) return o[B].exports; var Q = o[B] = { i: B, l: !1, exports: {} }; return A[B].call(Q.exports, Q, Q.exports, e), Q.l = !0, Q.exports } var o = {}; return e.m = A, e.c = o, e.d = function (A, o, B) { e.o(A, o) || Object.defineProperty(A, o, { configurable: !1, enumerable: !0, get: B }) }, e.n = function (A) { var o = A && A.__esModule ? function () { return A.default } : function () { return A }; return e.d(o, "a", o), o }, e.o = function (A, e) { return Object.prototype.hasOwnProperty.call(A, e) }, e.p = "", e(e.s = 0) }([function (A, e, o) { "use strict"; function B(A, e) { if (!(A instanceof e)) throw new TypeError("Cannot call a class as a function") } var Q = function () { function A(A, e) { for (var o = 0; o < e.length; o++) { var B = e[o]; B.enumerable = B.enumerable || !1, B.configurable = !0, "value" in B && (B.writable = !0), Object.defineProperty(A, B.key, B) } } return function (e, o, B) { return o && A(e.prototype, o), B && A(e, B), e } }(), t = o(1), n = t.webm, c = t.mp4, E = "undefined" != typeof navigator && parseFloat(("" + (/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0, ""])[1]).replace("undefined", "3_2").replace("_", ".").replace("_", "")) < 10 && !window.MSStream, l = function () { function A() { var e = this; B(this, A), E ? this.noSleepTimer = null : (this.noSleepVideo = document.createElement("video"), this.noSleepVideo.setAttribute("muted", ""), this.noSleepVideo.setAttribute("title", "No Sleep"), this.noSleepVideo.setAttribute("playsinline", ""), this._addSourceToVideo(this.noSleepVideo, "webm", n), this._addSourceToVideo(this.noSleepVideo, "mp4", c), this.noSleepVideo.addEventListener("loadedmetadata", function () { e.noSleepVideo.duration <= 1 ? e.noSleepVideo.setAttribute("loop", "") : e.noSleepVideo.addEventListener("timeupdate", function () { e.noSleepVideo.currentTime > .5 && (e.noSleepVideo.currentTime = Math.random()) }) })) } return Q(A, [{ key: "_addSourceToVideo", value: function (A, e, o) { var B = document.createElement("source"); B.src = o, B.type = "video/" + e, A.appendChild(B) } }, { key: "enable", value: function () { E ? (this.disable(), console.warn("\n        NoSleep enabled for older iOS devices. This can interrupt\n        active or long-running network requests from completing successfully.\n        See https://github.com/richtr/NoSleep.js/issues/15 for more details.\n      "), this.noSleepTimer = window.setInterval(function () { document.hidden || (window.location.href = window.location.href.split("#")[0], window.setTimeout(window.stop, 0)) }, 15e3)) : this.noSleepVideo.play() } }, { key: "disable", value: function () { E ? this.noSleepTimer && (console.warn("\n          NoSleep now disabled for older iOS devices.\n        "), window.clearInterval(this.noSleepTimer), this.noSleepTimer = null) : this.noSleepVideo.pause() } }]), A }(); A.exports = l }, function (A, e, o) { "use strict"; A.exports = { webm: "data:video/webm;base64,GkXfo0AgQoaBAUL3gQFC8oEEQvOBCEKCQAR3ZWJtQoeBAkKFgQIYU4BnQI0VSalmQCgq17FAAw9CQE2AQAZ3aGFtbXlXQUAGd2hhbW15RIlACECPQAAAAAAAFlSua0AxrkAu14EBY8WBAZyBACK1nEADdW5khkAFVl9WUDglhohAA1ZQOIOBAeBABrCBCLqBCB9DtnVAIueBAKNAHIEAAIAwAQCdASoIAAgAAUAmJaQAA3AA/vz0AAA=", mp4: "data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQAD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" } }]) });
        var isPC = false;
        var isMobile = false;
        //initiate as false
        // device detection
        if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)
            || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0, 4))) {
            isMobile = true;
            console.log("isMobile:" + isMobile);
        } else {
            isPC = true;
            console.log("isPC" + isPC);

        }

        var startRenderLoop = function (engine, canvas) {
            engine.runRenderLoop(function () {
                if (sceneToRender && sceneToRender.activeCamera) {
                    sceneToRender.render();
                }
            });
        }

        var engine = null;
        var scene = null;
        var sceneToRender = null;
        var createDefaultEngine = function () { return new BABYLON.Engine(canvas, true, { preserveDrawingBuffer: true, stencil: true, disableWebGL2Support: false }); };
        var camera, camera2;
        var run = false;
        var back = false;
        var left = false;
        var right = false;

        var moveController;
        var timer = 0;

        var createScene = async function () {
            var scene = new BABYLON.Scene(engine);

            const lights = {};
            const env = {};
            const shadows = {};
            const camera = new BABYLON.ArcRotateCamera("camera", BABYLON.Tools.ToRadians(0), BABYLON.Tools.ToRadians(70), 0.5, new BABYLON.Vector3(0.0, 0.1, 0.0), scene);
            camera.minZ = 0.01;
            camera.upperRadiusLimit = 200;
            camera.lowerRadiusLimit = 45;
            camera.upperBetaLimit = 1.25;
            camera.lowerBetaLimit = 0;
            camera.attachControl(canvas, true);


            if(isMobile){
                camera2 = new BABYLON.FreeCamera("DeviceCamera", new BABYLON.Vector3(60, 8, 0.1), scene);
                camera2.setTarget(new BABYLON.Vector3(-2.5, 8, 0));
                camera2.inertia *= 0.95;
                camera2.ellipsoid = new BABYLON.Vector3(1, 4, 1);
                camera2.speed = 2;
                camera2.detachControl(canvas, true);
                camera2.invertRotation = true;
            }
            else{
                camera2 = new BABYLON.UniversalCamera("UniversalCamera", new BABYLON.Vector3(60, 8, 0.1), scene);
                camera2.setTarget(new BABYLON.Vector3(-2.5, 8, 0));

                camera2.attachControl(canvas, true);
                camera2.inertia *= 0.95;
                camera2.ellipsoid = new BABYLON.Vector3(1, 4, 1);
                camera2.speed = 2;
                camera2.invertRotation = false;
                camera2.detachControl(canvas);
                camera2.touchAngularSensibility = 50000;

                
            camera2.keysUp = [87]; // W
            camera2.keysDown = [83]; // S
            camera2.keysLeft = [65]; // Q
            camera2.keysRight = [68]; // D

            }





            // var dome2 = new BABYLON.PhotoDome(
            // "testdome",
            // "./textures/equirectangular.jpg",
            //     {
            //         resolution: 32,
            //         size: 1000
            //     },
            //     scene
            // );
            // dome2.position = new BABYLON.Vector3(0,0,0);

            //     // Fog
            scene.fogMode = BABYLON.Scene.FOGMODE_EXP;
            //BABYLON.Scene.FOGMODE_NONE;
            //BABYLON.Scene.FOGMODE_EXP;
            //BABYLON.Scene.FOGMODE_EXP2;
            //BABYLON.Scene.FOGMODE_LINEAR;

            scene.fogColor = new BABYLON.Color3(0.9, 0.9, 0.85);
            scene.fogDensity = 0.005;
            scene.fogEnabled = false;

            env.lighting = BABYLON.CubeTexture.CreateFromPrefilteredData("https://patrickryanms.github.io/BabylonJStextures/Demos/sodaBottle/assets/env/hamburg_hbf.env", scene);
            env.lighting.name = "hamburg_hbf";
            env.lighting.environmentIntensity = 0;
            env.lighting.gammaSpace = false;
            env.lighting.rotationY = BABYLON.Tools.ToRadians(0);
            scene.environmentTexture = env.lighting;

            env.skybox = BABYLON.MeshBuilder.CreateSphere("Dome", { slice: 1, diameter: 1024 }, scene);
            env.skyboxMaterial = new BABYLON.PBRMaterial("skyBox", scene);
            env.skyboxMaterial.backFaceCulling = false;
            env.skyboxMaterial.reflectionTexture = new BABYLON.CubeTexture("https://patrickryanms.github.io/BabylonJStextures/Demos/sodaBottle/assets/skybox/hamburg", scene);
            env.skyboxMaterial.reflectionTexture.coordinatesMode = BABYLON.Texture.SKYBOX_MODE;
            env.skyboxMaterial.diffuseColor = new BABYLON.Color3(0, 0, 0);
            env.skyboxMaterial.specularColor = new BABYLON.Color3(0, 0, 0);
            env.skyboxMaterial.microSurface = 0.35;
            env.skybox.material = env.skyboxMaterial;

            // //     This creates a light, aiming 0,1,0 - to the sky (non-mesh)
            // // var light = new BABYLON.HemisphericLight("light1", new BABYLON.Vector3(0, 1, 0), scene);

            // // Default intensity is 1. Let's dim the light a small amount
            // // light.intensity = 0.5;

            var light = new BABYLON.DirectionalLight("dir01", new BABYLON.Vector3(-1, -1, 1), scene);
            light.position = new BABYLON.Vector3(20, 30, -20);

            // Default intensity is 1. Let's dim the light a small amount
            light.intensity = 3;
            var shadowGenerator = new BABYLON.ShadowGenerator(1024, light);

            shadowGenerator.useBlurExponentialShadowMap = true;
            //  shadowGenerator.useKernelBlur = true;
            //  shadowGenerator.blurKernel = 2;
            // shadowGenerator.blurScale = 1;
            // shadowGenerator.blurBoxOffset = 0.4;
            // shadowGenerator.depthScale = 0;
            shadowGenerator.enableSoftTransparentShadow = true;
            shadowGenerator.transparencyShadow = true;
            shadowGenerator.darkness = 0.1;

            var myGround = BABYLON.MeshBuilder.CreateGround("myGround", { width: 200, height: 200, subdivisions: 8 }, scene);
            myGround.position = new BABYLON.Vector3(0, 0, 0);
            myGround.visibility = false;

            var mat = new BABYLON.StandardMaterial("mat1", scene);
            mat.diffuseColor = new BABYLON.Color3(1, 1, 0);
            mat.emissiveColor = new BABYLON.Color3(1, 1, 0);

            var Paper1 = BABYLON.MeshBuilder.CreateBox("Box1", { height: 1, width: 0.75, depth: 0.1 });
            Paper1.position = new BABYLON.Vector3(0, 5, 0);
            Paper1.rotation.x = -Math.PI / 8;
            Paper1.visibility = false;
            Paper1.material = mat;

            var mat2 = new BABYLON.StandardMaterial("mat2", scene);
            mat2.diffuseColor = new BABYLON.Color3(1, 0, 0);
            mat2.emissiveColor = new BABYLON.Color3(1, 0, 0);

            var Paper2 = BABYLON.MeshBuilder.CreateBox("Box2", { height: 1, width: 0.75, depth: 0.1 });
            Paper2.position = new BABYLON.Vector3(53, 15, -46);
            Paper2.rotation.x = -Math.PI / 8;
            Paper2.visibility = false;
            Paper2.material = mat2;


            var mat3 = new BABYLON.StandardMaterial("mat3", scene);
            mat3.diffuseColor = new BABYLON.Color3(1, 0.65, 0);
            mat3.emissiveColor = new BABYLON.Color3(1, 0.65, 0);

            var Paper3 = BABYLON.MeshBuilder.CreateBox("Box3", { height: 1, width: 0.75, depth: 0.1 });
            Paper3.position = new BABYLON.Vector3(-34, 9, 56);
            Paper3.rotation.x = -Math.PI / 8;
            Paper3.visibility = false;
            Paper3.material = mat3;

            camera2.onCollide = function (colMesh) {
                // if(colMesh.name === "energyPack"){
                //     console.log("Energy pack acquired");
                //     // Remove the energy pack from the scene and restore 20% energy to the player
                //     colMesh.dispose();

                // } 

                if (colMesh.name === "Box1") {
                    console.log("Page 1 Info");
                    bottomLine.text = "Page 1 acquired";
                    rectangle.isVisible = true;
                    tb2.isVisible = true;
                    Paper2.visibility = true;
                    // Remove the health pack from the scene and restore 10% health to the player
                    colMesh.dispose();

                    setTimeout(function () {
                        topLine.text = "";
                        bottomLine.text = "";
                    }, 3000);
                }
                if (colMesh.name === "Box2") {
                    console.log("Page 2 Info");
                    bottomLine.text = "Page 2 acquired";
                    tb2.isVisible = false;
                    rectangle.isVisible = true;
                    tb3.isVisible = true;
                    Paper3.visibility = true;
                    // Remove the health pack from the scene and restore 10% health to the player
                    colMesh.dispose();

                    setTimeout(function () {
                        topLine.text = "";
                        bottomLine.text = "";
                    }, 3000);
                }
                if (colMesh.name === "Box3") {
                    console.log("Page 3 Info");
                    bottomLine.text = "Page 3 acquired";
                    tb3.isVisible = false;
                    rectangle.isVisible = true;
                    tb4.isVisible = true;
                    // Remove the health pack from the scene and restore 10% health to the player
                    colMesh.dispose();

                    setTimeout(function () {
                        topLine.text = "";
                        bottomLine.text = "";
                    }, 3000);
                }

            }


            let isLocked = false;
            scene.onPointerDown = function (evt) {
                console.log(camera2.angularSensibility);

                if (rectangle.isVisible) {
                    rectangle.isVisible = false;
                    tb.isVisible = false;
                }

                if (scene.activeCamera == camera2) {
                    if (document.pointerLockElement !== canvas) {
                        console.log("Was Already locked: ", document.pointerLockElement === canvas);

                        if (isPC) {
                            canvas.requestPointerLock = canvas.requestPointerLock || canvas.msRequestPointerLock || canvas.mozRequestPointerLock || canvas.webkitRequestPointerLock || false;

                            if (canvas.requestPointerLock) {
                                canvas.requestPointerLock();
                            }
                        }
                    }

                    

                    // evt === 0 (left mouse click)          
                    if (evt.button == 0 && scene.activeCamera == camera2) {
                        // console.log(camera2.position);
                        // Shoot at camera's ray target 
                        let ray = camera2.getForwardRay();
                        ray.length = 25;
                        let hit = scene.pickWithRay(ray);
                        let model = hit.pickedMesh;
                        // Exempt ground mesh from being shot at
                        if (model != null) {
                            if (model.name == "Box1") {
                                // Destroy target mesh
                                model.dispose();
                                console.log("Page 1 Info");
                                bottomLine.text = "Page 1 acquired";
                                rectangle.isVisible = true;
                                tb2.isVisible = true;
                                Paper2.visibility = true;
                                inventBut1.image.source = "images/Page1.png";


                                setTimeout(function () {
                                    topLine.text = "";
                                    bottomLine.text = "";
                                }, 3000);
                            }
                            if (model.name == "Box2" && model != null) {
                                // Destroy target mesh
                                model.dispose();
                                console.log("Page 2 Info");
                                bottomLine.text = "Page 2 acquired";
                                tb2.isVisible = false;
                                rectangle.isVisible = true;
                                tb3.isVisible = true;
                                Paper3.visibility = true;
                                inventBut2.image.source = "images/Page2.png";

                                setTimeout(function () {
                                    topLine.text = "";
                                    bottomLine.text = "";
                                }, 3000);
                            }
                            if (model.name == "Box3" && model != null) {
                                // Destroy target mesh
                                model.dispose();
                                console.log("Page 3 Info");
                                bottomLine.text = "Page 3 acquired";
                                tb3.isVisible = false;
                                rectangle.isVisible = true;
                                tb4.isVisible = true;
                                inventBut3.image.source = "images/Page3.png";

                                setTimeout(function () {
                                    topLine.text = "";
                                    bottomLine.text = "";
                                }, 3000);
                            }
                        }
                    }

                    // Event listener when the pointerlock is updated (or removed by pressing ESC for example).
                    var pointerlockchange = function () {
                        if (isPC) {
                            var controlEnabled = document.pointerLockElement || document.mozPointerLockElement || document.webkitPointerLockElement || document.msPointerLockElement || false;

                            // If the user is already locked
                            if (!controlEnabled) {
                                camera2.detachControl(canvas);
                                isLocked = false;

                            } else {
                                camera2.attachControl(canvas);
                                isLocked = true;
                                this.active = true;
                            }
                        }
                    };
                    // Attach events to the document
                    document.addEventListener("pointerlockchange", pointerlockchange, false);
                    document.addEventListener("mspointerlockchange", pointerlockchange, false);
                    document.addEventListener("mozpointerlockchange", pointerlockchange, false);
                    document.addEventListener("webkitpointerlockchange", pointerlockchange, false);
                }
            }


            const [topLine, bottomLine, progressBar] = createUI();

            BABYLON.SceneLoader.ShowLoadingScreen = false;

            BABYLON.SceneLoader.OnPluginActivatedObservable.addOnce(function (loader) {

                loader.onCompleteObservable.add(function () {
                    bottomLine.text = "Loading Complete";
                    for (var i = 0; i < scene.meshes.length; i++) {
                        if (scene.meshes[i].name.includes("Plane") || scene.meshes[i].name == "Cylinder.002" || scene.meshes[i].name == "Circle") {
                            scene.meshes[i].receiveShadows = true;
                            scene.meshes[i].material.environmentIntensity = 0.25;
                        }
                        if (scene.meshes[i].name.includes("Cube")) {
                            shadowGenerator.addShadowCaster(scene.meshes[i]);
                            scene.meshes[i].checkCollisions = true;
                            scene.meshes[i].material.environmentIntensity = 0.25;
                        }
                    }
                    setTimeout(function () {
                        topLine.text = "";
                        bottomLine.text = "Light and Shadows Updated";
                    }, 2000);
                    setTimeout(function () {
                        topLine.text = "";
                        bottomLine.text = "";
                        button2.isVisible = true;
                        Paper1.visibility = true;
                    }, 4000);
                });
            });


            BABYLON.SceneLoader.AppendAsync("https://dl.dropbox.com/s/wn9dmi5d1v3p5iu/Park.glb?dl=0", "Park.glb",
                scene,
                function (meshes) {
                    if (meshes.lengthComputable) {
                        bottomLine.text = "Loading, please wait..." + (meshes.loaded * 100 / meshes.total).toFixed() + "%";
                    }
                    else {
                        var dlCount = meshes.loaded / (1024 * 1024);
                        bottomLine.text = "Loading, please wait..." + Math.floor(dlCount * 100.0) / 100.0 + " MB already loaded.";
                    }
                });

            scene.gravity = new BABYLON.Vector3(0, -0.9, 0);

            scene.collisionsEnabled = true;
            if (isMobile) {
                camera2.applyGravity = true;
                camera2._needMoveForGravity = true;
                camera2.checkCollisions = true;
                var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");
                var button3 = BABYLON.GUI.Button.CreateSimpleButton("but3", "Walking");
                button3.width = "220px"
                button3.height = "120px";
                button3.color = "Black";
                button3.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
                button3.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
                button3.top = "-150px";
                button3.cornerRadius = 5;
                button3.background = "white";
                button3.alpha = 0.75;
                button3.onPointerDownObservable.add(function () {
                    run = true;
                });
                button3.onPointerUpObservable.add(function () {
                    run = false;
                });
                button3.isVisible = false;
                advancedTexture.addControl(button3);
            }
            else {
                camera2.applyGravity = true;
                camera2._needMoveForGravity = true;
                camera2.checkCollisions = true;
            }
            myGround.checkCollisions = true;
            Paper1.checkCollisions = true;
            Paper2.checkCollisions = true;
            Paper3.checkCollisions = true;

            var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

            var target = BABYLON.Mesh.CreatePlane("targetViewVR");
            var circle = new BABYLON.GUI.Ellipse();
            circle.width = "20px";
            circle.height = "20px";
            circle.color = "white";
            circle.thickness = 3;
            advancedTexture.addControl(circle);
            target.isPickable = false;
            circle.isVisible = false;

            var inventory = new BABYLON.GUI.Rectangle("invent");
            inventory.background = "gray";
            inventory.width = "50%";
            inventory.height = "27%";
            inventory.alpha = 0.85;
            inventory.isVisible = false;
            advancedTexture.addControl(inventory);

            var inventBut1 = BABYLON.GUI.Button.CreateImageOnlyButton("Page1", "");
            inventBut1.width = "33%";
            inventBut1.height = "100%";
            inventBut1.background = "white";
            inventBut1.horizontalAlignment =  BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            inventBut1.onPointerDownObservable.add(function () {
                if(inventBut1.image.source != ""){
                    rectangle.isVisible =  !rectangle.isVisible;
                    tb2.isVisible = true;
                    tb4.isVisible = false;
                    tb3.isVisible = false;
                }
            });
            inventory.addControl(inventBut1);    
            var inventBut2 = BABYLON.GUI.Button.CreateImageOnlyButton("Page2", "");
            inventBut2.width = "33%";
            inventBut2.height = "100%";
            inventBut2.background = "white";
            inventBut2.onPointerDownObservable.add(function () {
                if(inventBut2.image.source != ""){
                    rectangle.isVisible =  !rectangle.isVisible;
                    tb3.isVisible = true;
                    tb2.isVisible = false;
                    tb4.isVisible = false;
                }
            });
            inventBut2.horizontalAlignment =  BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER;
            inventory.addControl(inventBut2);    
            var inventBut3 = BABYLON.GUI.Button.CreateImageOnlyButton("Page3", "");
            inventBut3.width = "33%";
            inventBut3.height = "100%";
            inventBut3.background = "white";
            inventBut3.onPointerDownObservable.add(function () {
                if(inventBut3.image.source != ""){
                    rectangle.isVisible =  !rectangle.isVisible;
                    tb4.isVisible = true;
                    tb2.isVisible = false;
                    tb3.isVisible = false;
                }
            });
            inventBut3.horizontalAlignment =  BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            inventory.addControl(inventBut3);    


            var rectangle = new BABYLON.GUI.Rectangle("rect");
            rectangle.background = "gray";
            rectangle.width = "50%";
            rectangle.height = "75%";
            rectangle.alpha = 0.85;
            advancedTexture.addControl(rectangle);



            // textblock.text = " \n \n In Walking Mode: \n Use WASD for WALK \n Use Shift to SPRINT \n Walk over or left click to collect the Pages";

            var tb = new MixedTextBlock();
            tb.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            tb.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            //tb.resizeToFit = true;
            tb.multiTextArgs = [
                { text: "\n In Arc Rotate Mode:", fillStyle: "white", font: "bold 35px Helvetica" },
                { text: "\n \n Have a look at the park in Arc Rotate Mode", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: `\n \n \n In Walking Mode:`, fillStyle: "white", font: "bold 35px Helvetica" },
                { text: "\n \n Use WASD for WALK \n Use Shift to SPRINT \n Walk over or left click to collect the Pages", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n Press I Key to open Inventory", fillStyle: "white", font: "bold 25px Helvetica" }
            ];
            tb.text = "hi";
            rectangle.addControl(tb);

            var tb2 = new MixedTextBlock();
            tb2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb2.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            tb2.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb2.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            //tb.resizeToFit = true;
            tb2.multiTextArgs = [
                { text: "\n Mysterious case of Jack Thompson", fillStyle: "white", font: "bold 35px Helvetica" },
                { text: "\n \n Part 1 of 3", fillStyle: "white", font: "bold 30px Helvetica" },
                { text: "\n \n \n It was a dark and stormy night when the body of young Jack Thompson was found in the park. He was just 15 years old and had been reported missing by his parents the night before. When the police arrived on the scene, they found Jack's body lying in a pond, with no visible injuries.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n The case quickly became a mystery, as there were no witnesses and no leads. The police searched the park for clues, but they were unable to find anything that could help them solve the case.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n As the days passed, the community was in a state of panic. People were afraid to go out at night, and parents were keeping their children indoors.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n ...", fillStyle: "white", font: "bold 25px Helvetica" }
            ];
            tb2.text = "hi";
            tb2.isVisible = false;
            rectangle.addControl(tb2);

            var tb3 = new MixedTextBlock();
            tb3.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb3.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            tb3.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb3.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            //tb.resizeToFit = true;
            tb3.multiTextArgs = [
                { text: "\n Mysterious case of Jack Thompson", fillStyle: "white", font: "bold 35px Helvetica" },
                { text: "\n \n Part 2 of 3", fillStyle: "white", font: "bold 30px Helvetica" },
                { text: "\n \n \n The police were under a lot of pressure to solve the case and determine the cause of Jack's death.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n After conducting an autopsy, the medical examiner determined that Jack had drowned. It was discovered that he had been playing near the pond when he accidentally fell in and was unable to swim to safety.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n Just when the case seemed to be solved, a shocking revelation came to light. One of Jack's classmates, a girl named Emily, came forward and confessed to being with Jack at the pond when he fell in. She claimed that it was an accident and that she had tried to save him, but was unable to do so.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n ...", fillStyle: "white", font: "bold 25px Helvetica" }
            ];
            tb3.text = "hi";
            tb3.isVisible = false;
            rectangle.addControl(tb3);

            var tb4 = new MixedTextBlock();
            tb4.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb4.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            tb4.textHorizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            tb4.textVerticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            //tb.resizeToFit = true;
            tb4.multiTextArgs = [
                { text: "\n Mysterious case of Jack Thompson", fillStyle: "white", font: "bold 35px Helvetica" },
                { text: "\n \n Part 3 of 3", fillStyle: "white", font: "bold 30px Helvetica" },
                { text: "\n \n \n The police were sympathetic to Emily's story and, after investigating further, determined that her confession was truthful. She was not charged with any crime and the case was finally closed.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n The community was relieved to know that Jack's death was a tragic accident and not a murder. They were grateful to Emily for coming forward and helping to bring closure to the case.", fillStyle: "white", font: "bold 25px Helvetica" },
                { text: "\n \n The mysterious death of Jack Thompson remained a topic of conversation for years to come, as people tried to understand how such a tragedy could have occurred in their small town.", fillStyle: "white", font: "bold 25px Helvetica" }
            ];
            tb4.text = "hi";
            tb4.isVisible = false;
            rectangle.addControl(tb4);


            var button2 = BABYLON.GUI.Button.CreateSimpleButton("but2", "Walking");
            button2.width = "150px"
            button2.height = "40px";
            button2.color = "Black";
            button2.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            button2.left = "-50px";
            button2.cornerRadius = 5;
            button2.background = "white";
            button2.onPointerUpObservable.add(function () {
                if (scene.activeCamera == camera2) {
                    camera2.detachControl(canvas);
                    scene.activeCamera = camera;
                    camera.attachControl(canvas, true);
                    button2.textBlock.text = "Walking"
                    scene.fogEnabled = false;
                    progressBar.isVisible = false;
                    circle.isVisible = false;
                    if (isMobile) {
                        button3.isVisible = false;
                    }
                } else {
                    camera.detachControl(canvas);
                    scene.activeCamera = camera2;
                    camera2.attachControl(canvas, true);
                    button2.textBlock.text = "Arc Rot"
                    scene.fogEnabled = true;
                    progressBar.isVisible = true;
                    circle.isVisible = true;
                    if (isMobile) {
                        button3.isVisible = true;
                    }
                }
            });
            // buttonInv.isVisible = false;
            // advancedTexture.addControl(buttonInv);

            // var buttonInv = BABYLON.GUI.Button.CreateSimpleButton("but2", "Walking");
            // buttonInv.width = "150px"
            // buttonInv.height = "40px";
            // buttonInv.color = "Black";
            // buttonInv.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT;
            // buttonInv.left = "-50px";
            // buttonInv.cornerRadius = 5;
            // buttonInv.background = "white";
            // buttonInv.onPointerUpObservable.add(function () {
            //     if (scene.activeCamera == camera2) {
            //         camera2.detachControl(canvas);
            //         scene.activeCamera = camera;
            //         camera.attachControl(canvas, true);
            //         button2.textBlock.text = "Walking"
            //         scene.fogEnabled = false;
            //         progressBar.isVisible = false;
            //         circle.isVisible = false;
            //         if (isMobile) {
            //             button3.isVisible = false;
            //         }
            //     } else {
            //         camera.detachControl(canvas);
            //         scene.activeCamera = camera2;
            //         camera2.attachControl(canvas, true);
            //         button2.textBlock.text = "Arc Rot"
            //         scene.fogEnabled = true;
            //         progressBar.isVisible = true;
            //         circle.isVisible = true;
            //         if (isMobile) {
            //             button3.isVisible = true;
            //         }
            //     }
            // });
            // button2.isVisible = false;
            // advancedTexture.addControl(button2);
 


            scene.onBeforeRenderObservable.add(function () {
                var cameraForwardRayPosition = camera2.getForwardRay().direction;
                if (isMobile && button3.isVisible) {
                    var cameraForwardRayPosition = camera2.getForwardRay().direction;
                    let ray = camera2.getForwardRay();
                    ray.length = 25;
                    let hit = scene.pickWithRay(ray);
                    console.log(hit.pickedMesh + "O:O" +hit.distance);
                    if (run == true && hit.distance <= 0 || run == true && hit.distance >= 10 ) {
                        //camera2.position.z-=0.1
                        var v2 = BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(0, 0, 2), BABYLON.Matrix.RotationY(camera2.rotation.y));
                        camera2.position.addInPlace(v2);
                        // camera2.checkCollisions = true;
                        // camera2.position = direction+ 0.1;sss
                    }
                }
                else {
                    //camera2.cameraRotation = direction ;
                    if (run == true) {
                        //camera2.position.z-=0.1
                        var v2 = BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(0, 0, 0.1), BABYLON.Matrix.RotationY(camera2.rotation.y));
                        camera2.position.addInPlace(v2);
                        // camera2.checkCollisions = true;
                        // camera2.position = direction+ 0.1;
                    }
                    if (back == true) {
                        // camera2.position.z+=0.1

                        var v2 = BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(0, 0, -0.1), BABYLON.Matrix.RotationY(camera2.rotation.y));
                        camera2.position.addInPlace(v2);

                    }
                    if (left == true) {
                        var v2 = BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(-0.1, 0, 0), BABYLON.Matrix.RotationY(camera2.rotation.y));
                        camera2.position.addInPlace(v2);
                    }
                    if (right == true) {
                        // camera2.position.x-=0.1
                        var v2 = BABYLON.Vector3.TransformCoordinates(new BABYLON.Vector3(0.1, 0, 0), BABYLON.Matrix.RotationY(camera2.rotation.y));
                        camera2.position.addInPlace(v2);
                    }
                }
                Paper1.rotation.y += 0.05;
                Paper2.rotation.y += 0.05;
                Paper3.rotation.y += 0.05;
            });

            var energy = 50, shiftPressed = false , ipressed = false;
            scene.onBeforeRenderObservable.add(function () {
                // console.log(camera2.position);
                if (shiftPressed && scene.activeCamera == camera2) {
                    if (energy > 0) {
                        camera2.speed = 1.5;
                        energy--;
                        progressBar.width = energy / 1 / 100;
                    }
                    else {
                        camera2.speed = 0.5;
                        if (energy < 50 && !shiftPressed) {
                            energy += 0.5;
                            progressBar.width = energy / 1 / 100;
                        }
                    }
                } else {
                    camera2.speed = 0.5;
                    if (energy < 50) {
                        energy += 0.5;
                        progressBar.width = energy / 1 / 100;
                    }
                }
                if(ipressed){
                    inventory.isVisible = true;
                    if(isPC){
                        document.exitPointerLock = document.exitPointerLock ||
                        document.mozExitPointerLock ||
                        document.webkitExitPointerLock;
                        document.exitPointerLock();
                    }
                }
                else{
                    inventory.isVisible = false;
                }
                // console.log("Energy " + energy);
            });
            scene.onKeyboardObservable.add((kbInfo) => {
                switch (kbInfo.type) {
                    case BABYLON.KeyboardEventTypes.KEYDOWN:
                        switch (kbInfo.event.key) {
                            case "Shift":
                                shiftPressed = true;
                            break;
                            case "i":
                                ipressed = !ipressed;
                            break
                        }
                        break;

                    case BABYLON.KeyboardEventTypes.KEYUP:
                        switch (kbInfo.event.key) {
                            case "Shift":
                                shiftPressed = false;
                            break;
                        }
                }
            });

            var glowLayer = new BABYLON.GlowLayer("glow", scene, {
                mainTextureFixedSize: 256,
                blurKernelSize: 128
            });
            glowLayer.intensity = 0.75;


            return scene;
        };


        function createUI() {
            // Create full screen UI.
            const uiTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("UI");

            // Create attribution line of text.
            const attributionLine = new BABYLON.GUI.TextBlock();
            attributionLine.color = "lightgray";
            attributionLine.fontSize = 12;
            attributionLine.top = "-45%";
            attributionLine.text = " Asset created by player11en";
            uiTexture.addControl(attributionLine);

            // Create top line of text.
            const topLine = new BABYLON.GUI.TextBlock();
            topLine.color = "white";
            topLine.fontSize = 24;
            topLine.top = "-38%";
            uiTexture.addControl(topLine);

            // Create bottom line of text.
            const bottomLine = new BABYLON.GUI.TextBlock();
            bottomLine.color = "white";
            bottomLine.fontSize = 24;
            bottomLine.top = "45%";
            uiTexture.addControl(bottomLine);

            const progressBar = new BABYLON.GUI.Rectangle();
            progressBar.width = 0.5;
            progressBar.height = "15px";
            progressBar.outlineWidth = "2px";
            progressBar.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
            progressBar.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_TOP;
            progressBar.top = "10px";
            progressBar.left = "5px";
            progressBar.isVisible = false;
            progressBar.background = BABYLON.Color3.FromHexString("#99EE99").toHexString();
            uiTexture.addControl(progressBar);

            return [topLine, bottomLine, progressBar];
        }

        window.initFunction = async function () {
            var asyncEngineCreation = async function () {
                try {
                    return createDefaultEngine();
                } catch (e) {
                    console.log("the available createEngine function failed. Creating the default engine instead");
                    return createDefaultEngine();
                }
            }

            window.engine = await asyncEngineCreation();
            if (!engine) throw 'engine should not be null.';
            startRenderLoop(engine, canvas);
            window.scene = createScene();
        };
        initFunction().then(() => {
            scene.then(returnedScene => { sceneToRender = returnedScene; });

        });

        // Resize
        window.addEventListener("resize", function () {
            engine.resize();
        });


        var __extends = (this && this.__extends) || (function () {
            var extendStatics = function (d, b) {
                extendStatics = Object.setPrototypeOf ||
                    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
                    function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };
                return extendStatics(d, b);
            };
            return function (d, b) {
                extendStatics(d, b);
                function __() { this.constructor = d; }
                d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
            };
        })();
        var MixedTextBlock = /** @class */ (function (_super) {
            __extends(MixedTextBlock, _super);
            function MixedTextBlock() {
                return _super !== null && _super.apply(this, arguments) || this;
            }
            Object.defineProperty(MixedTextBlock.prototype, "multiTextArgs", {
                set: function (value) {
                    this._multiTextArgs = value;
                },
                enumerable: false,
                configurable: true
            });
            MixedTextBlock.prototype._drawText = function (text, textWidth, y, context) {
                var width = this._currentMeasure.width;
                var x = 0;
                switch (this._textHorizontalAlignment) {
                    case BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT:
                        x = 10;
                        break;
                    case BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_RIGHT:
                        x = width - textWidth;
                        break;
                    case BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_CENTER:
                        x = (width - textWidth) / 2;
                        break;
                }
                if (this.shadowBlur || this.shadowOffsetX || this.shadowOffsetY) {
                    context.shadowColor = this.shadowColor;
                    context.shadowBlur = this.shadowBlur;
                    context.shadowOffsetX = this.shadowOffsetX;
                    context.shadowOffsetY = this.shadowOffsetY;
                }
                if (this.outlineWidth) {
                    context.strokeText(text, this._currentMeasure.left + x, y);
                }
                var Y = y - this._fontOffset.height
                try {
                    Y = Y + parseInt(this._multiTextArgs[0].font.split(" ")[1].replace("px", ""))
                }
                catch (e) {
                    Y = this._fontOffset.height
                }
                this._fillMixedText(context, this._multiTextArgs, this._currentMeasure.left + x, Y);
            };
            MixedTextBlock.prototype._fillMixedText = function (context, args, x, y) {
                var defaultFillStyle = context.fillStyle;
                var defaultFont = context.font;
                var defaultOffset = this._fontOffset.height
                var lineStart = x
                var lineBreak = this._currentMeasure.top
                var windowWidth = this._currentMeasure.width - 30
                context.save();
                args.forEach(function (_a) {
                    var text = _a.text, fillStyle = _a.fillStyle, font = _a.font;
                    var splittedText = text.split(" ")
                    var height = 0
                    try {
                        height = parseInt(_a.font.split(" ")[1].replace("px", ""))
                    }
                    catch (e) {
                        height = defaultOffset
                    }
                    context.fillStyle = fillStyle || defaultFillStyle;
                    context.font = font || defaultFont;
                    splittedText.forEach(function (word) {
                        var finalText = word.split("\n")
                        if (finalText.length > 1) {
                            for (var i = 0; i < finalText.length; i++) {
                                finalText[i] = " " + finalText[i]
                                if (x - lineStart + context.measureText(finalText[i]).width > windowWidth) {
                                    x = lineStart
                                    y += height
                                    finalText[i] = finalText[i].replace(" ", "")
                                }
                                if (x == lineStart)
                                    finalText[i] = finalText[i].replace(" ", "")
                                context.fillText(finalText[i], x, y);
                                x += context.measureText(finalText[i]).width;
                                if (i != finalText.length - 1) {
                                    y += height
                                    x = lineStart
                                }
                            }
                        }
                        else {
                            word = " " + word
                            if (x - lineStart + context.measureText(word).width > windowWidth) {
                                x = lineStart
                                y += height
                                word = word.replace(" ", "")
                            }
                            if (x == lineStart)
                                word = word.replace(" ", "")
                            context.fillText(word, x, y);
                            x += context.measureText(word).width;
                        }
                    })

                });
                context.restore();
            };
            return MixedTextBlock;
        }(BABYLON.GUI.TextBlock)); //end MixedTextBlock-class

    </script>
</body>

</html>